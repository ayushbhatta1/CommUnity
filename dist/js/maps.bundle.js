!function(){const e={map:null,markers:[],userLocation:null,searchRadius:5e3,resourceTypes:{food:{icon:"üçΩÔ∏è",color:"#4CAF50"},housing:{icon:"üè†",color:"#2196F3"},healthcare:{icon:"üè•",color:"#F44336"},education:{icon:"üìö",color:"#9C27B0"},employment:{icon:"üíº",color:"#FF9800"}}};async function o(o){if(!e.userLocation)throw new Error("User location not available");e.markers.forEach((e=>e.setMap(null))),e.markers=[];const t=await fetch("/api/resources/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o,location:e.userLocation,radius:e.searchRadius})});if(!t.ok)throw new Error("Failed to search resources");return t.json()}function t(o){return`\n        <div class="info-window">\n            <h3>${(e.resourceTypes[o.type]||e.resourceTypes.food).icon} ${o.name}</h3>\n            <p>${o.description}</p>\n            <div class="info-details">\n                <p>üìç ${o.address}</p>\n                <p>üìû ${o.phone||"No phone available"}</p>\n                <p>‚è∞ ${o.hours||"Hours not available"}</p>\n            </div>\n            <div class="info-actions">\n                <button onclick="getDirections('${o.id}')">Get Directions</button>\n                <button onclick="saveResource('${o.id}')">Save</button>\n            </div>\n        </div>\n    `}function n(e){const o=document.createElement("div");o.className="notification error",o.textContent=e,document.body.appendChild(o),setTimeout((()=>o.remove()),3e3)}window.maps={initMap:function(){e.map=new google.maps.Map(document.getElementById("map-container"),{center:{lat:40.7128,lng:-74.006},zoom:12,styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),navigator.geolocation&&navigator.geolocation.getCurrentPosition((o=>{const t={lat:o.coords.latitude,lng:o.coords.longitude};e.userLocation=t,e.map.setCenter(t),new google.maps.Marker({position:t,map:e.map,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:"#4285F4",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:2},title:"Your Location"})}),(e=>{console.error("Error getting location:",e),n("Unable to get your location. Please enable location services.")})),function(){const r=document.getElementById("resource-search");r&&r.addEventListener("input",function(){let r;return function(...s){clearTimeout(r),r=setTimeout((()=>{clearTimeout(r),(async r=>{const s=r.target.value.trim();if(!(s.length<2))try{!function(o){if(o.forEach((o=>{const n=function(o){const t=e.resourceTypes[o.type]||e.resourceTypes.food;return new google.maps.Marker({position:{lat:o.location.lat,lng:o.location.lng},map:e.map,title:o.name,icon:{path:google.maps.SymbolPath.CIRCLE,scale:12,fillColor:t.color,fillOpacity:.8,strokeColor:"#FFFFFF",strokeWeight:2}})}(o);e.markers.push(n);const r=new google.maps.InfoWindow({content:t(o)});n.addListener("click",(()=>{r.open(e.map,n)}))})),e.markers.length>0){const o=new google.maps.LatLngBounds;e.markers.forEach((e=>o.extend(e.getPosition()))),e.map.fitBounds(o)}}(await o(s))}catch(e){console.error("Error searching resources:",e),n("Failed to search resources. Please try again.")}})(...s)}),300)}}())}()},searchNearbyResources:o,getDirections:function(o){const t=findResourceById(o);if(!t||!e.userLocation)return;const r=new google.maps.DirectionsService,s=new google.maps.DirectionsRenderer;s.setMap(e.map),r.route({origin:e.userLocation,destination:t.location,travelMode:google.maps.TravelMode.TRANSIT},((e,o)=>{"OK"===o?s.setDirections(e):n("Failed to get directions. Please try again.")}))},saveResource:function(e){const o=JSON.parse(localStorage.getItem("savedResources")||"[]");o.includes(e)||(o.push(e),localStorage.setItem("savedResources",JSON.stringify(o)),function(){const e=document.createElement("div");e.className="notification success",e.textContent="Resource saved successfully!",document.body.appendChild(e),setTimeout((()=>e.remove()),3e3)}())}}}();