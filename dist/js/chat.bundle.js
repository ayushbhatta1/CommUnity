!function(){const e={messages:[],isTyping:!1,openaiKey:null},t={chatMessages:document.getElementById("chat-messages"),chatInput:document.getElementById("chat-input"),sendButton:document.getElementById("send-message")};async function s(){const s=t.chatInput,a=s.value.trim();if(a&&!e.isTyping){n("user",a),s.value="",e.isTyping=!0,function(){const e=t.chatMessages;if(!e)return;const s=document.createElement("div");s.className="chat-message assistant typing-indicator",s.innerHTML='\n        <div class="message-bubble">\n            <span class="dot"></span>\n            <span class="dot"></span>\n            <span class="dot"></span>\n        </div>\n    ',e.appendChild(s),e.scrollTop=e.scrollHeight}();try{const t=await async function(t){if(!e.openaiKey)throw new Error("OpenAI API key not found");const s=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e.openaiKey}`},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"system",content:"You are a helpful assistant for the CommUnity platform, focused on helping underserved individuals find resources, jobs, and support. Be empathetic, clear, and practical in your responses."},...e.messages.map((e=>({role:e.type,content:e.content}))),{role:"user",content:t}],temperature:.7,max_tokens:150})});if(!s.ok)throw new Error("Failed to get AI response");return(await s.json()).choices[0].message.content}(a);n("assistant",t)}catch(e){console.error("Error getting AI response:",e),n("assistant","I apologize, but I encountered an error. Please try again.")}finally{e.isTyping=!1,function(){const e=document.querySelector(".typing-indicator");e&&e.remove()}()}}}function n(t,s){const n={type:t,content:s,timestamp:(new Date).toISOString()};e.messages.push(n),a(),localStorage.setItem("chatMessages",JSON.stringify(e.messages))}function a(){const s=t.chatMessages;s&&(s.innerHTML=e.messages.map((e=>`\n        <div class="chat-message ${e.type}">\n            <div class="message-bubble">\n                ${e.content}\n            </div>\n            <div class="message-timestamp">\n                ${new Date(e.timestamp).toLocaleTimeString()}\n            </div>\n        </div>\n    `)).join(""),s.scrollTop=s.scrollHeight)}document.addEventListener("DOMContentLoaded",(function(){e.openaiKey=process.env.OPENAI_API_KEY;const n=localStorage.getItem("chatMessages");n&&(e.messages=JSON.parse(n),a()),t.chatInput?.addEventListener("keypress",(e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),s())})),t.sendButton?.addEventListener("click",s)})),window.chat={sendMessage:s,clearChat:function(){e.messages=[],a(),localStorage.removeItem("chatMessages")}}}();